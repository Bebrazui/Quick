(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[931],{1253:function(e,t,a){Promise.resolve().then(a.bind(a,9681))},9681:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return eJ}});var s=a(7437),n=a(2265),i=a(5110),r=a(4984),l=a(4425);let c=(0,a(960).X3)("nostr-p2p-files",1,{upgrade(e){e.objectStoreNames.contains("transfers")||e.createObjectStore("transfers",{keyPath:"transferId"}),e.objectStoreNames.contains("chunks")||e.createObjectStore("chunks",{keyPath:["transferId","index"]})}});function o(e){let t=atob(e),a=new Uint8Array(t.length);for(let e=0;e<t.length;e++)a[e]=t.charCodeAt(e);return a}async function d(e){var t,a;let s=await c,n=await s.get("transfers",e.transferId),i={...e,receivedChunks:null!==(a=null!==(t=null==n?void 0:n.receivedChunks)&&void 0!==t?t:e.receivedChunks)&&void 0!==a?a:0};return await s.put("transfers",i),i}async function h(e,t,a,s){let n=(await c).transaction(["chunks","transfers"],"readwrite"),i=[e,t];if(!await n.objectStore("chunks").get(i)){await n.objectStore("chunks").put({transferId:e,index:t,data:s});let i=await n.objectStore("transfers").get(e);i?(i.receivedChunks=Math.min(i.totalChunks,i.receivedChunks+1),await n.objectStore("transfers").put(i)):await n.objectStore("transfers").put({transferId:e,fileName:"file",mimeType:"application/octet-stream",fileType:"file",size:0,totalChunks:a,receivedChunks:1})}await n.done}async function u(e){let t=await c;return await t.get("transfers",e)}async function m(e){let t=await u(e);return!!t&&t.totalChunks>0&&t.receivedChunks>=t.totalChunks}async function x(e,t,a){let s=await c,n=await s.get("transfers",e);if(!n)throw Error("Transfer not found");let i=t||n.fileName||"file",r=a||n.mimeType||"application/octet-stream",l=IDBKeyRange.bound([e,0],[e,Number.MAX_SAFE_INTEGER]),d=s.transaction("chunks","readonly").objectStore("chunks");if("showSaveFilePicker"in window&&window.isSecureContext){let e=window.showSaveFilePicker,t=await e({suggestedName:i,types:[{description:"File",accept:{[r]:["."+i.split(".").pop()]}}]}),a=await t.createWritable(),s=await d.openCursor(l);for(;s;){let e=s.value;await a.write(o(e.data)),s=await s.continue()}await a.close();return}let h=[],u=await d.openCursor(l);for(;u;){let e=u.value;h.push(o(e.data)),u=await u.continue()}let m=new Blob(h,{type:r}),x=URL.createObjectURL(m),p=document.createElement("a");p.href=x,p.download=i,document.body.appendChild(p),p.click(),document.body.removeChild(p),URL.revokeObjectURL(x)}let p=["wss://relay.damus.io","wss://nos.lol","wss://relay.snort.social","wss://relay.primal.net","wss://purplepag.es","wss://nostr.mom","wss://relay.nostr.bg"];class b{get publicKey(){return this._pk}get privateKeyHex(){return this._sk?(0,l.ci)(this._sk):""}get relays(){return[...this._relays]}get channels(){return[...this._channels]}get sk(){return this._sk}getRelayStatus(e){return this.relayStatus.get(e)||"disconnected"}get connectedRelayCount(){let e=0;for(let t of this.relayStatus.values())"connected"===t&&e++;return e}generateKeys(){let e=(0,i.cV)(),t=(0,i.$3)(e);return{privateKey:(0,l.ci)(e),publicKey:t}}login(e){let t=(0,l.nr)(e),a=(0,i.$3)(t);return this._sk=t,this._pk=a,this._stopped=!1,localStorage.setItem("nostr_sk",e),a}logout(){this._stopped=!0,this.disconnectAll(),this._sk=null,this._pk="",localStorage.removeItem("nostr_sk"),localStorage.removeItem("nostr_contacts")}tryAutoLogin(){let e=localStorage.getItem("nostr_sk");if((null==e?void 0:e.length)===64)try{return this.login(e),!0}catch(e){localStorage.removeItem("nostr_sk")}return!1}onMessage(e){return this.messageCallbacks.add(e),()=>{this.messageCallbacks.delete(e)}}onChannel(e){return this.channelCallbacks.add(e),()=>{this.channelCallbacks.delete(e)}}onChannelMessage(e){return this.channelMessageCallbacks.add(e),()=>{this.channelMessageCallbacks.delete(e)}}onProfile(e){return this.profileCallbacks.add(e),()=>{this.profileCallbacks.delete(e)}}onConnection(e){return this.connectionCallbacks.add(e),()=>{this.connectionCallbacks.delete(e)}}onSignal(e){return this.signalCallbacks.add(e),()=>{this.signalCallbacks.delete(e)}}async connectToRelays(){for(let e of this._relays)this.connectToRelay(e)}setChannels(e){for(let[t,a]of(this._channels=[...new Set(e.filter(Boolean))],this.sockets))a.readyState===WebSocket.OPEN&&this.subscribeToChannels(t)}connectToRelay(e){if(!this._stopped){if(this.sockets.has(e)){let t=this.sockets.get(e);if(t.readyState===WebSocket.OPEN||t.readyState===WebSocket.CONNECTING)return}this.relayStatus.set(e,"connecting"),this.connectionCallbacks.forEach(t=>t(e,"disconnected"));try{let t=new WebSocket(e),a=setTimeout(()=>{t.readyState!==WebSocket.OPEN&&t.close()},8e3);this.sockets.set(e,t),t.onopen=()=>{clearTimeout(a),this.reconnectAttempts.set(e,0),this.relayStatus.set(e,"connected"),this.connectionCallbacks.forEach(t=>t(e,"connected")),this.subscribeToMessages(e)},t.onclose=()=>{clearTimeout(a),this.relayStatus.set(e,"disconnected"),this.connectionCallbacks.forEach(t=>t(e,"disconnected")),this.sockets.delete(e),this.scheduleReconnect(e)},t.onerror=()=>{this.relayStatus.set(e,"error"),this.connectionCallbacks.forEach(t=>t(e,"error"))},t.onmessage=e=>{try{this.handleRelayMessage(JSON.parse(e.data))}catch(e){}}}catch(t){this.relayStatus.set(e,"error"),this.scheduleReconnect(e)}}}scheduleReconnect(e){if(this._stopped)return;let t=this.reconnectTimers.get(e);t&&clearTimeout(t);let a=this.reconnectAttempts.get(e)||0;this.reconnectAttempts.set(e,a+1),this.reconnectTimers.set(e,setTimeout(()=>{!this._stopped&&this._sk&&this.connectToRelay(e)},Math.min(3e3*Math.pow(2,a),6e4)))}handleRelayMessage(e){if(Array.isArray(e)&&"EVENT"===e[0]){let t=e[2];!t||this.seenEvents.has(t.id)||(this.seenEvents.add(t.id),4===t.kind?this.handleEncryptedDM(t):0===t.kind?this.handleProfileEvent(t):40===t.kind?this.handleChannelEvent(t):42===t.kind&&this.handleChannelMessageEvent(t))}}async handleEncryptedDM(e){if(!this._sk)return;let t=e.tags.find(e=>"p"===e[0]);if(!t)return;let a=t[1]===this._pk,s=e.pubkey===this._pk;if(!a&&!s)return;let n=s?t[1]:e.pubkey;try{let a=await (0,r.p)(this._sk,n,e.content);try{let s=JSON.parse(a);if(null==s?void 0:s._nostr_msg_type){let a=s._nostr_msg_type;if("text"===a){this.messageCallbacks.forEach(a=>a({id:e.id,from:e.pubkey,to:t[1],content:s.text||"",timestamp:1e3*e.created_at,msgType:"text",replyTo:s.replyTo}));return}if(["webrtc-offer","webrtc-answer","webrtc-ice","call-request","call-accept","call-reject","call-end"].includes(a)){this.signalCallbacks.forEach(t=>t(e.pubkey,{type:a,sdp:s.sdp,candidate:s.candidate,callType:s.callType}));return}if("file-chunk"===a){this.handleFileChunk(e.id,e.pubkey,t[1],1e3*e.created_at,s);return}if("file-meta"===a){let e=s.transferId||"";if(!e)return;await d({transferId:e,fileName:s.fileName||"file",mimeType:s.mimeType||"application/octet-stream",fileType,size:s.size||0,totalChunks:s.totalChunks||0,text:s.text||""});return}if("image"===a||"file"===a){this.messageCallbacks.forEach(n=>n({id:e.id,from:e.pubkey,to:t[1],content:s.text||"",timestamp:1e3*e.created_at,msgType:a,replyTo:s.replyTo,attachment:{type:a,name:s.fileName||"file",mimeType:s.mimeType||"application/octet-stream",data:s.data||"",size:s.size||0}}));return}}}catch(e){}this.messageCallbacks.forEach(s=>s({id:e.id,from:e.pubkey,to:t[1],content:a,timestamp:1e3*e.created_at,msgType:"text"}))}catch(e){}}async handleFileChunk(e,t,a,s,n){let i=n.transferId,r=n.chunkIndex,l=n.totalChunks,c=n.data;if(!i||"number"!=typeof r||"number"!=typeof l||"string"!=typeof c)return;let o="image"===n.fileType?"image":"file";await d({transferId:i,fileName:n.fileName||"file",mimeType:n.mimeType||"application/octet-stream",fileType:o,size:n.size||0,totalChunks:l,text:n.text||""}),await h(i,r,l,c),await m(i)&&this.messageCallbacks.forEach(r=>r({id:"".concat(e,"-assembled-").concat(i),from:t,to:a,content:n.text||"",timestamp:s,msgType:o,replyTo:n.replyTo,attachment:{type:o,name:n.fileName||"file",mimeType:n.mimeType||"application/octet-stream",data:"",size:n.size||0,transferId:i,totalChunks:l,chunked:!0}}))}handleProfileEvent(e){try{let t=JSON.parse(e.content);this.profileCache.set(e.pubkey,t),this.pendingProfiles.delete(e.pubkey),this.profileCallbacks.forEach(a=>a(e.pubkey,t))}catch(e){}}handleChannelEvent(e){try{var t;let a=JSON.parse(e.content),s={id:e.id,name:(null===(t=a.name)||void 0===t?void 0:t.trim())||"channel-".concat(e.id.slice(0,8)),about:a.about,createdBy:e.pubkey,createdAt:1e3*e.created_at};this.channelCallbacks.forEach(e=>e(s))}catch(e){}}handleChannelMessageEvent(e){var t;let a=null===(t=e.tags.find(e=>"e"===e[0]))||void 0===t?void 0:t[1];if(a)try{let t=JSON.parse(e.content);this.channelMessageCallbacks.forEach(s=>s({id:e.id,from:e.pubkey,to:"",content:t.text||"",timestamp:1e3*e.created_at,msgType:"channel",channelId:a,replyTo:t.replyTo}))}catch(t){this.channelMessageCallbacks.forEach(t=>t({id:e.id,from:e.pubkey,to:"",content:e.content||"",timestamp:1e3*e.created_at,msgType:"channel",channelId:a}))}}subscribeToMessages(e){if(!this._pk)return;let t=this.sockets.get(e);if(!t||t.readyState!==WebSocket.OPEN)return;let a="dm-"+Math.random().toString(36).slice(2,8),s=Math.floor(Date.now()/1e3)-2592e3;t.send(JSON.stringify(["REQ",a,{kinds:[4],"#p":[this._pk],since:s},{kinds:[4],authors:[this._pk],since:s}])),this.subscriptions.set(a,{filters:[],relay:e}),this.subscribeToChannels(e)}subscribeToChannels(e){let t=this.sockets.get(e);if(!t||t.readyState!==WebSocket.OPEN||0===this._channels.length)return;let a="ch-"+Math.random().toString(36).slice(2,8),s=Math.floor(Date.now()/1e3)-2592e3;t.send(JSON.stringify(["REQ",a,{kinds:[40],ids:this._channels,since:s},{kinds:[42],"#e":this._channels,since:s}])),this.subscriptions.set(a,{filters:[],relay:e})}async sendEncryptedPayload(e,t){if(!this._sk)throw Error("Не авторизован");let a=await (0,r.H)(this._sk,e,t),s={kind:4,created_at:Math.floor(Date.now()/1e3),tags:[["p",e]],content:a,pubkey:this._pk},n=(0,i._W)(s,this._sk);this.seenEvents.add(n.id);let l=JSON.stringify(["EVENT",n]),c=[];for(let[,e]of this.sockets)e.readyState===WebSocket.OPEN&&c.push(e);if(!c.length)throw Error("Нет подключённых релеев");return c.forEach(e=>{try{e.send(l)}catch(e){}}),n.id}bytesToBase64(e){let t="";for(let a=0;a<e.length;a+=32768)t+=String.fromCharCode(...e.subarray(a,a+32768));return btoa(t)}async sendDirectMessage(e,t,a){let s=a?JSON.stringify({_nostr_msg_type:"text",text:t,replyTo:a}):t;return{id:await this.sendEncryptedPayload(e,s),from:this._pk,to:e,content:t,timestamp:Date.now(),msgType:"text",replyTo:a}}async sendAttachment(e,t,a,s,n){if(t.size>2147483648)throw Error("File is too large. Max size is 2GB.");if(!t.file){let s=t.data;if(s.length<4e4)return{id:await this.sendEncryptedPayload(e,JSON.stringify({_nostr_msg_type:t.type,fileName:t.name,mimeType:t.mimeType,data:s,size:t.size,text:a||"",replyTo:n})),from:this._pk,to:e,content:a||"",timestamp:Date.now(),msgType:t.type,attachment:t,replyTo:n}}let i=t.file,r=Math.random().toString(36).slice(2)+Date.now().toString(36),l=i?i.size:t.size,c=Math.ceil(l/b.CHUNK_SIZE),o="",d=0;await this.sendEncryptedPayload(e,JSON.stringify({_nostr_msg_type:"file-meta",transferId:r,totalChunks:c,fileName:t.name,mimeType:t.mimeType,size:l,text:a||"",fileType:t.type,replyTo:n}));for(let h=0;h<c;h+=b.PARALLEL){let u=[];for(let s=0;s<b.PARALLEL&&h+s<c;s++){let o=h+s;if(i){let s=o*b.CHUNK_SIZE,d=Math.min(s+b.CHUNK_SIZE,l),h=new Uint8Array(await i.slice(s,d).arrayBuffer()),m=this.bytesToBase64(h);u.push(this.sendEncryptedPayload(e,JSON.stringify({_nostr_msg_type:"file-chunk",transferId:r,chunkIndex:o,totalChunks:c,data:m,fileName:t.name,mimeType:t.mimeType,size:l,text:a||"",fileType:t.type,replyTo:n})))}else{let s=Math.floor(b.CHUNK_SIZE/3*4),i=t.data.slice(o*s,(o+1)*s);u.push(this.sendEncryptedPayload(e,JSON.stringify({_nostr_msg_type:"file-chunk",transferId:r,chunkIndex:o,totalChunks:c,data:i,fileName:t.name,mimeType:t.mimeType,size:l,text:a||"",fileType:t.type,replyTo:n})))}}let m=await Promise.all(u);o=m[m.length-1]||o,d+=u.length,null==s||s(d,c),d<c&&await new Promise(e=>setTimeout(e,50))}return{id:o||"local-".concat(r),from:this._pk,to:e,content:a||"",timestamp:Date.now(),msgType:t.type,replyTo:n,attachment:{...t,data:t.file?"":t.data,transferId:r,totalChunks:c,chunked:!0}}}async sendWebRTCSignal(e,t){await this.sendEncryptedPayload(e,JSON.stringify({_nostr_msg_type:t.type,sdp:t.sdp,candidate:t.candidate,callType:t.callType}))}async createChannel(e,t){if(!this._sk)throw Error("Not authorized");let a={kind:40,created_at:Math.floor(Date.now()/1e3),tags:[],content:JSON.stringify({name:e,about:t||""}),pubkey:this._pk},s=(0,i._W)(a,this._sk),n=JSON.stringify(["EVENT",s]);for(let[,e]of this.sockets)if(e.readyState===WebSocket.OPEN)try{e.send(n)}catch(e){}let r={id:s.id,name:e,about:t,createdBy:this._pk,createdAt:Date.now()};return this.channelCallbacks.forEach(e=>e(r)),r}async sendChannelMessage(e,t,a){if(!this._sk)throw Error("Not authorized");let s={kind:42,created_at:Math.floor(Date.now()/1e3),tags:[["e",e,"","root"]],content:JSON.stringify({text:t,replyTo:a}),pubkey:this._pk},n=(0,i._W)(s,this._sk),r=JSON.stringify(["EVENT",n]),l=!1;for(let[,e]of this.sockets)if(e.readyState===WebSocket.OPEN){l=!0;try{e.send(r)}catch(e){}}if(!l)throw Error("No connected relays");return{id:n.id,from:this._pk,to:"",content:t,timestamp:Date.now(),msgType:"channel",channelId:e,replyTo:a}}requestProfile(e){if(this.profileCache.has(e))return this.profileCache.get(e);if(this.pendingProfiles.has(e))return null;this.pendingProfiles.add(e);let t="p-"+Math.random().toString(36).slice(2,8);for(let[,a]of this.sockets)if(a.readyState===WebSocket.OPEN){a.send(JSON.stringify(["REQ",t,{kinds:[0],authors:[e],limit:1}]));break}return null}getProfile(e){return this.profileCache.get(e)||null}async updateProfile(e){if(!this._sk)throw Error("Не авторизован");let t={kind:0,created_at:Math.floor(Date.now()/1e3),tags:[],content:JSON.stringify(e),pubkey:this._pk},a=JSON.stringify(["EVENT",(0,i._W)(t,this._sk)]);for(let[,e]of this.sockets)if(e.readyState===WebSocket.OPEN)try{e.send(a)}catch(e){}this.profileCache.set(this._pk,e)}disconnectAll(){for(let[,e]of this.reconnectTimers)clearTimeout(e);for(let[,e]of(this.reconnectTimers.clear(),this.reconnectAttempts.clear(),this.sockets))e.close();this.sockets.clear(),this.subscriptions.clear(),this.relayStatus.clear()}addRelay(e){this._relays.includes(e)||(this._relays.push(e),this.connectToRelay(e))}removeRelay(e){this._relays=this._relays.filter(t=>t!==e);let t=this.reconnectTimers.get(e);t&&(clearTimeout(t),this.reconnectTimers.delete(e)),this.reconnectAttempts.delete(e);let a=this.sockets.get(e);a&&(a.close(),this.sockets.delete(e)),this.relayStatus.delete(e)}shortenKey(e){return!e||e.length<16?e:e.slice(0,8)+"…"+e.slice(-8)}isValidHexKey(e){return/^[0-9a-fA-F]{64}$/.test(e)}constructor(){this._sk=null,this._pk="",this.sockets=new Map,this.relayStatus=new Map,this.subscriptions=new Map,this.messageCallbacks=new Set,this.channelCallbacks=new Set,this.channelMessageCallbacks=new Set,this.profileCallbacks=new Set,this.connectionCallbacks=new Set,this.signalCallbacks=new Set,this.profileCache=new Map,this.pendingProfiles=new Set,this.seenEvents=new Set,this._relays=[...p],this.reconnectAttempts=new Map,this.reconnectTimers=new Map,this._stopped=!1,this._channels=[]}}b.CHUNK_SIZE=262144,b.PARALLEL=3;let g=new b,y={contacts:[],channels:[],messages:new Map,channelMessages:new Map,activeChat:null,isLoggedIn:!1,showSidebar:!0},f=new Set;function v(){f.forEach(e=>e())}function w(){return y}function j(e){return f.add(e),()=>f.delete(e)}function N(){return(0,n.useSyncExternalStore)(j,w)}function k(e){if(y={...y,activeChat:e},e&&!e.startsWith("channel:")){let t=y.contacts.map(t=>t.pubkey===e?{...t,unread:0}:t);y={...y,contacts:t}}v()}function C(e){y={...y,isLoggedIn:e},v()}function S(){y={...y,showSidebar:!y.showSidebar},v()}function T(e,t,a,s){y={...y,contacts:y.contacts.map(n=>n.pubkey===e?{...n,name:t||n.name,picture:a,about:s}:n)},v()}function _(e){var t;let a=e.from===g.publicKey?e.to:e.from,s=y.messages.get(a)||[];if(s.find(t=>t.id===e.id))return;let n=[...s,e].sort((e,t)=>e.timestamp-t.timestamp),i=new Map(y.messages);i.set(a,n);let r="image"===e.msgType?"\uD83D\uDDBC️ Photo":"file"===e.msgType?"\uD83D\uDCCE ".concat((null===(t=e.attachment)||void 0===t?void 0:t.name)||"File"):e.content,l=y.contacts.map(t=>t.pubkey===a?{...t,lastMessage:r,lastMessageTime:e.timestamp,unread:y.activeChat===a?0:(t.unread||0)+(e.from!==g.publicKey?1:0)}:t);l.find(e=>e.pubkey===a)||e.from===g.publicKey||(l.push({pubkey:a,name:g.shortenKey(a),lastMessage:r,lastMessageTime:e.timestamp,unread:y.activeChat===a?0:1}),g.requestProfile(a),D()),y={...y,messages:i,contacts:l},v()}function E(e){y.channels.find(t=>t.id===e.id)||(y={...y,channels:[e,...y.channels]},localStorage.setItem("nostr_channels",JSON.stringify(y.channels)),g.setChannels(y.channels.map(e=>e.id)),v())}function M(e){let t=e.channelId;if(!t)return;let a=y.channelMessages.get(t)||[];if(a.find(t=>t.id===e.id))return;let s=[...a,e].sort((e,t)=>e.timestamp-t.timestamp),n=new Map(y.channelMessages);n.set(t,s),y={...y,channelMessages:n},v()}function R(e){return y.channelMessages.get(e)||[]}function P(e){return y.messages.get(e)||[]}function D(){let e=y.contacts.map(e=>({pubkey:e.pubkey,name:e.name}));localStorage.setItem("nostr_contacts",JSON.stringify(e))}function z(){try{let e=localStorage.getItem("nostr_contacts");if(e){let t=JSON.parse(e).map(e=>({pubkey:e.pubkey,name:e.name||g.shortenKey(e.pubkey),unread:0}));y={...y,contacts:t},v(),t.forEach(e=>g.requestProfile(e.pubkey))}}catch(e){}}var Z=a(521),O=a(1239),I=a(8906),A=a(9202),K=a(9397),L=a(9090),W=a(4001),F=a(401),U=a(8867);function B(){let[e,t]=(0,n.useState)("choice"),[a,i]=(0,n.useState)(null),[r,l]=(0,n.useState)(""),[c,o]=(0,n.useState)(""),[d,h]=(0,n.useState)(!1),[u,m]=(0,n.useState)(!1),x=async()=>{a&&(await navigator.clipboard.writeText(a.privateKey),h(!0),setTimeout(()=>h(!1),2e3))};return(0,s.jsxs)("div",{className:"h-full flex items-center justify-center bg-bg p-4",children:[(0,s.jsxs)("div",{className:"absolute inset-0 overflow-hidden pointer-events-none",children:[(0,s.jsx)("div",{className:"absolute top-1/4 left-1/4 w-96 h-96 bg-accent/5 rounded-full blur-3xl"}),(0,s.jsx)("div",{className:"absolute bottom-1/4 right-1/4 w-96 h-96 bg-cyan/5 rounded-full blur-3xl"})]}),(0,s.jsxs)(Z.E.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"relative z-10 w-full max-w-md",children:["choice"===e&&(0,s.jsxs)("div",{className:"text-center",children:[(0,s.jsx)(Z.E.div,{initial:{scale:.8},animate:{scale:1},transition:{type:"spring",stiffness:200},className:"inline-flex items-center justify-center w-20 h-20 rounded-2xl bg-accent/10 border border-accent/20 mb-6",children:(0,s.jsx)(O.Z,{className:"w-10 h-10 text-accent"})}),(0,s.jsx)("h1",{className:"text-3xl font-bold text-text mb-2",style:{fontFamily:"Space Grotesk"},children:"NOSTR P2P"}),(0,s.jsx)("p",{className:"text-text-secondary text-sm mb-2",children:"Decentralized. Encrypted. Censorship-resistant."}),(0,s.jsxs)("div",{className:"flex items-center justify-center gap-4 text-xs text-text-muted mb-8",children:[(0,s.jsxs)("span",{className:"flex items-center gap-1",children:[(0,s.jsx)(I.Z,{className:"w-3 h-3"})," E2E Encrypted"]}),(0,s.jsxs)("span",{className:"flex items-center gap-1",children:[(0,s.jsx)(A.Z,{className:"w-3 h-3"})," No Central Server"]})]}),(0,s.jsxs)("div",{className:"space-y-3",children:[(0,s.jsxs)(Z.E.button,{whileHover:{scale:1.02},whileTap:{scale:.98},onClick:()=>{i(g.generateKeys()),t("generate")},className:"w-full flex items-center gap-3 px-5 py-4 bg-accent hover:bg-accent-hover text-white rounded-xl transition-colors text-sm font-medium",children:[(0,s.jsx)(K.Z,{className:"w-5 h-5"}),(0,s.jsxs)("div",{className:"text-left",children:[(0,s.jsx)("div",{children:"Generate New Identity"}),(0,s.jsx)("div",{className:"text-xs opacity-70",children:"Create a new keypair"})]})]}),(0,s.jsxs)(Z.E.button,{whileHover:{scale:1.02},whileTap:{scale:.98},onClick:()=>t("import"),className:"w-full flex items-center gap-3 px-5 py-4 bg-bg-tertiary hover:bg-bg-hover border border-border rounded-xl transition-colors text-sm font-medium text-text",children:[(0,s.jsx)(L.Z,{className:"w-5 h-5 text-text-secondary"}),(0,s.jsxs)("div",{className:"text-left",children:[(0,s.jsx)("div",{children:"Import Private Key"}),(0,s.jsx)("div",{className:"text-xs text-text-muted",children:"Use existing Nostr identity"})]})]})]})]}),"generate"===e&&a&&(0,s.jsxs)("div",{children:[(0,s.jsx)("button",{onClick:()=>t("choice"),className:"text-text-secondary hover:text-text text-sm mb-4 flex items-center gap-1",children:"← Back"}),(0,s.jsxs)("div",{className:"text-center mb-6",children:[(0,s.jsx)("div",{className:"inline-flex items-center justify-center w-14 h-14 rounded-xl bg-green/10 border border-green/20 mb-4",children:(0,s.jsx)(W.Z,{className:"w-7 h-7 text-green"})}),(0,s.jsx)("h2",{className:"text-xl font-bold text-text",style:{fontFamily:"Space Grotesk"},children:"Your New Identity"}),(0,s.jsx)("p",{className:"text-text-secondary text-xs mt-1",children:"Save your private key securely!"})]}),(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"text-xs text-text-muted uppercase tracking-wider mb-1 block",children:"Public Key"}),(0,s.jsx)("div",{className:"bg-bg-tertiary border border-border rounded-lg p-3 text-xs text-text-secondary font-mono break-all",children:a.publicKey})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"text-xs text-text-muted uppercase tracking-wider mb-1 block",children:"Private Key (SECRET)"}),(0,s.jsx)("div",{className:"bg-red-dim border border-red/20 rounded-lg p-3 text-xs text-red font-mono break-all",children:a.privateKey})]}),(0,s.jsxs)("button",{onClick:x,className:"w-full flex items-center justify-center gap-2 px-4 py-3 bg-bg-tertiary hover:bg-bg-hover border border-border rounded-lg text-sm text-text transition-colors",children:[d?(0,s.jsx)(F.Z,{className:"w-4 h-4 text-green"}):(0,s.jsx)(U.Z,{className:"w-4 h-4"}),d?"Copied!":"Copy Private Key"]}),(0,s.jsxs)("label",{className:"flex items-center gap-2 text-sm text-text-secondary cursor-pointer",children:[(0,s.jsx)("input",{type:"checkbox",checked:u,onChange:e=>m(e.target.checked),className:"rounded accent-accent"}),"I have saved my private key securely"]}),(0,s.jsx)(Z.E.button,{whileHover:{scale:1.02},whileTap:{scale:.98},onClick:()=>{a&&(g.login(a.privateKey),g.connectToRelays(),z(),C(!0))},disabled:!u,className:"w-full px-5 py-4 bg-accent hover:bg-accent-hover disabled:opacity-30 disabled:cursor-not-allowed text-white rounded-xl transition-all text-sm font-medium",children:"Enter Messenger"})]})]}),"import"===e&&(0,s.jsxs)("div",{children:[(0,s.jsx)("button",{onClick:()=>t("choice"),className:"text-text-secondary hover:text-text text-sm mb-4 flex items-center gap-1",children:"← Back"}),(0,s.jsxs)("div",{className:"text-center mb-6",children:[(0,s.jsx)("div",{className:"inline-flex items-center justify-center w-14 h-14 rounded-xl bg-accent/10 border border-accent/20 mb-4",children:(0,s.jsx)(L.Z,{className:"w-7 h-7 text-accent"})}),(0,s.jsx)("h2",{className:"text-xl font-bold text-text",style:{fontFamily:"Space Grotesk"},children:"Import Key"}),(0,s.jsx)("p",{className:"text-text-secondary text-xs mt-1",children:"Enter your Nostr private key (hex)"})]}),(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsx)("div",{children:(0,s.jsx)("textarea",{value:r,onChange:e=>l(e.target.value),placeholder:"Enter 64-character hex private key...",rows:3,className:"w-full bg-bg-tertiary border border-border rounded-lg p-3 text-sm text-text font-mono resize-none focus:outline-none focus:border-accent placeholder:text-text-muted"})}),c&&(0,s.jsx)("p",{className:"text-red text-xs",children:c}),(0,s.jsx)(Z.E.button,{whileHover:{scale:1.02},whileTap:{scale:.98},onClick:()=>{o("");let e=r.trim().replace(/^nsec1/,"");if(!g.isValidHexKey(e)){o("Invalid private key. Must be 64 hex characters.");return}try{g.login(e),g.connectToRelays(),z(),C(!0)}catch(e){o("Failed to login with this key.")}},className:"w-full px-5 py-4 bg-accent hover:bg-accent-hover text-white rounded-xl transition-colors text-sm font-medium",children:"Login"})]})]})]})]})}var J=a(8614),H=a(2718),V=a(5287),G=a(7806),q=a(1217),Q=a(8728),Y=a(2451),X=a(3247),$=a(3581),ee=a(2926),et=a(2489),ea=a(7692),es=a(8930),en=a(3145);let ei=[["#7c5cfc","#22d3ee"],["#f472b6","#fbbf24"],["#4ade80","#22d3ee"],["#f87171","#fb923c"],["#a78bfa","#f472b6"],["#22d3ee","#4ade80"],["#fbbf24","#f87171"],["#fb923c","#a78bfa"],["#34d399","#818cf8"],["#f97316","#ec4899"],["#06b6d4","#8b5cf6"],["#84cc16","#06b6d4"],["#e879f9","#38bdf8"],["#fb7185","#c084fc"],["#2dd4bf","#a855f7"],["#facc15","#f43f5e"]],er={xs:{outer:"w-7 h-7",inner:"w-6 h-6",text:"text-[10px]",dot:"w-2 h-2 -bottom-0 -right-0",border:"2px",size:24},sm:{outer:"w-9 h-9",inner:"w-8 h-8",text:"text-xs",dot:"w-2.5 h-2.5 -bottom-0 -right-0",border:"2px",size:32},md:{outer:"w-11 h-11",inner:"w-10 h-10",text:"text-sm",dot:"w-3 h-3 -bottom-0.5 -right-0.5",border:"2px",size:40},lg:{outer:"w-16 h-16",inner:"w-14 h-14",text:"text-xl",dot:"w-3.5 h-3.5 bottom-0 right-0",border:"3px",size:56},xl:{outer:"w-24 h-24",inner:"w-[86px] h-[86px]",text:"text-3xl",dot:"w-4 h-4 bottom-0.5 right-0.5",border:"3px",size:86}};function el(e){let{pubkey:t,name:a,picture:i,size:r="md",showBorder:l=!0,online:c,className:o=""}=e,d=(0,n.useMemo)(()=>{let e=function(e){let t=0;for(let a=0;a<e.length;a++)t=(t<<5)-t+e.charCodeAt(a)|0;return Math.abs(t)}(t)%ei.length;return ei[e]},[t]),h=er[r],u=(a||t||"?")[0].toUpperCase(),m=l?{background:"linear-gradient(135deg, ".concat(d[0],", ").concat(d[1],")"),padding:h.border}:{};return(0,s.jsxs)("div",{className:"relative shrink-0 ".concat(o),children:[(0,s.jsx)("div",{className:"".concat(h.outer," rounded-full flex items-center justify-center"),style:l?m:{},children:(0,s.jsx)("div",{className:"".concat(h.inner," rounded-full flex items-center justify-center overflow-hidden ").concat(l?"bg-bg-secondary":"bg-bg-tertiary"),style:l?{}:{background:"linear-gradient(135deg, ".concat(d[0],"22, ").concat(d[1],"22)"),border:"1px solid ".concat(d[0],"33")},children:i?(0,s.jsx)(en.default,{src:i,alt:a||"Avatar",width:h.size,height:h.size,className:"w-full h-full object-cover",onError:e=>{e.target.style.display="none"}}):(0,s.jsx)("span",{className:"".concat(h.text," font-bold"),style:{color:d[0]},children:u})})}),void 0!==c&&(0,s.jsx)("div",{className:"absolute ".concat(h.dot," rounded-full border-2 border-bg-secondary ").concat(c?"bg-green":"bg-text-muted")})]})}function ec(){let{contacts:e,channels:t,activeChat:a,showSidebar:i}=N(),[r,l]=(0,n.useState)(!1),[c,o]=(0,n.useState)(!1),[d,h]=(0,n.useState)(!1),[u,m]=(0,n.useState)(!1),[x,p]=(0,n.useState)(""),[b,f]=(0,n.useState)(""),[w,j]=(0,n.useState)(""),[_,M]=(0,n.useState)(""),[R,P]=(0,n.useState)(""),[z,O]=(0,n.useState)(""),[I,A]=(0,n.useState)(""),[K,L]=(0,n.useState)(!1),[W,B]=(0,n.useState)(""),[es,en]=(0,n.useState)(""),[ei,er]=(0,n.useState)(""),[ec,eh]=(0,n.useState)(!1),[eu,em]=(0,n.useState)(""),[,ex]=(0,n.useState)(0);(0,n.useEffect)(()=>{let e=g.onConnection(()=>ex(e=>e+1)),t=g.onChannel(e=>E(e));return()=>{e(),t()}},[]),(0,n.useEffect)(()=>g.onProfile((e,t)=>{T(e,t.name,t.picture,t.about),e===g.publicKey&&(B(t.name||""),en(t.about||""),er(t.picture||""))}),[]);let ep=async()=>{let e=w.trim();if(e)try{let t=await g.createChannel(e,_.trim());E(t),k("channel:".concat(t.id)),j(""),M(""),m(!1)}catch(e){}},eb=async()=>{await navigator.clipboard.writeText(g.publicKey),L(!0),setTimeout(()=>L(!1),1800)},eg=async()=>{eh(!0);try{await g.updateProfile({name:W,about:es,picture:ei})}catch(e){}eh(!1),h(!1)},ey=()=>{let e=I.trim();e&&(e.startsWith("wss://")||e.startsWith("ws://")||(e="wss://".concat(e)),g.addRelay(e),A(""),ex(e=>e+1))},ef=e.filter(e=>{var t;if(!z)return!0;let a=z.toLowerCase();return(null===(t=e.name)||void 0===t?void 0:t.toLowerCase().includes(a))||e.pubkey.includes(a)}).sort((e,t)=>(t.lastMessageTime||0)-(e.lastMessageTime||0)),ev=t.filter(e=>{if(!z)return!0;let t=z.toLowerCase();return e.name.toLowerCase().includes(t)||e.id.includes(t)}),ew=g.connectedRelayCount;return i?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)(Z.E.div,{initial:{x:-320},animate:{x:0},className:"w-80 h-full bg-bg-secondary border-r border-border flex flex-col shrink-0",children:[(0,s.jsxs)("div",{className:"p-4 border-b border-border",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)("h1",{className:"text-lg font-bold text-text",style:{fontFamily:"Space Grotesk"},children:"NOSTR MESH"}),(0,s.jsxs)("div",{className:"flex items-center gap-1 text-xs",children:[(0,s.jsx)(V.Z,{className:"w-3 h-3 ".concat(ew>0?"text-green":"text-red")}),(0,s.jsx)("span",{className:ew>0?"text-green":"text-red",children:ew})]})]}),(0,s.jsxs)("div",{className:"flex items-center gap-1",children:[(0,s.jsx)("button",{onClick:()=>l(!0),className:"p-2 rounded-lg hover:bg-bg-hover text-text-secondary hover:text-text transition-colors",title:"Add contact",children:(0,s.jsx)(G.Z,{className:"w-4 h-4"})}),(0,s.jsx)("button",{onClick:()=>m(!0),className:"p-2 rounded-lg hover:bg-bg-hover text-text-secondary hover:text-text transition-colors",title:"Create channel",children:(0,s.jsx)(q.Z,{className:"w-4 h-4"})}),(0,s.jsx)("button",{onClick:()=>o(!0),className:"p-2 rounded-lg hover:bg-bg-hover text-text-secondary hover:text-text transition-colors",title:"Settings",children:(0,s.jsx)(Q.Z,{className:"w-4 h-4"})}),(0,s.jsx)("button",{onClick:S,className:"p-2 rounded-lg hover:bg-bg-hover text-text-secondary hover:text-text transition-colors lg:hidden",children:(0,s.jsx)(Y.Z,{className:"w-4 h-4"})})]})]}),(0,s.jsxs)("button",{onClick:()=>{let e=g.getProfile(g.publicKey);B((null==e?void 0:e.name)||""),en((null==e?void 0:e.about)||""),er((null==e?void 0:e.picture)||""),h(!0)},className:"w-full flex items-center gap-2.5 px-2 py-2 bg-bg-tertiary hover:bg-bg-hover rounded-lg transition-colors",children:[(0,s.jsx)(el,{pubkey:g.publicKey,name:W,picture:ei,size:"sm",showBorder:!0}),(0,s.jsxs)("div",{className:"flex-1 min-w-0 text-left",children:[(0,s.jsx)("p",{className:"text-xs font-medium text-text truncate",children:W||g.shortenKey(g.publicKey)}),(0,s.jsx)("p",{className:"text-[10px] text-text-muted font-mono truncate",children:g.shortenKey(g.publicKey)})]}),(0,s.jsx)("button",{onClick:e=>{e.stopPropagation(),eb()},className:"p-1 rounded hover:bg-bg-active transition-colors",title:"Copy key",children:K?(0,s.jsx)(F.Z,{className:"w-3 h-3 text-green"}):(0,s.jsx)(U.Z,{className:"w-3 h-3 text-text-muted"})})]}),(0,s.jsxs)("div",{className:"relative mt-3",children:[(0,s.jsx)(X.Z,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-text-muted"}),(0,s.jsx)("input",{value:z,onChange:e=>O(e.target.value),placeholder:"Search chats/channels...",className:"w-full pl-9 pr-3 py-2 bg-bg-tertiary border border-border rounded-lg text-sm text-text placeholder:text-text-muted focus:outline-none focus:border-accent/50"})]})]}),(0,s.jsxs)("div",{className:"flex-1 overflow-y-auto",children:[(0,s.jsx)("div",{className:"px-4 pt-3 pb-1 text-[10px] uppercase tracking-wider text-text-muted",children:"Contacts"}),0===ef.length?(0,s.jsx)("div",{className:"px-4 py-2 text-xs text-text-muted",children:"No contacts yet."}):(0,s.jsx)("div",{className:"py-1",children:ef.map(e=>(0,s.jsx)(eo,{contact:e,isActive:a===e.pubkey,onClick:()=>{k(e.pubkey),window.innerWidth<1024&&S()},onRemove:()=>{var t;return t=e.pubkey,void(y={...y,contacts:y.contacts.filter(e=>e.pubkey!==t),activeChat:y.activeChat===t?null:y.activeChat},D(),v())}},e.pubkey))}),(0,s.jsx)("div",{className:"px-4 pt-4 pb-1 text-[10px] uppercase tracking-wider text-text-muted",children:"Channels"}),(0,s.jsx)("div",{className:"px-4 pb-2",children:(0,s.jsxs)("div",{className:"flex gap-2",children:[(0,s.jsx)("input",{value:R,onChange:e=>P(e.target.value),placeholder:"Channel ID",className:"flex-1 bg-bg-tertiary border border-border rounded-lg px-2.5 py-2 text-xs text-text font-mono placeholder:text-text-muted focus:outline-none focus:border-accent/50"}),(0,s.jsx)("button",{onClick:()=>{let e=R.trim();e&&(t.find(t=>t.id===e)||E({id:e,name:"channel-".concat(e.slice(0,8)),createdBy:"",createdAt:Date.now()}),k("channel:".concat(e)),P(""))},className:"px-2.5 py-2 bg-accent hover:bg-accent-hover rounded-lg text-xs text-white",children:"Join"})]})}),0===ev.length?(0,s.jsx)("div",{className:"px-4 py-2 text-xs text-text-muted",children:"No channels yet."}):(0,s.jsx)("div",{className:"py-1",children:ev.map(e=>(0,s.jsxs)("button",{onClick:()=>{k("channel:".concat(e.id)),window.innerWidth<1024&&S()},className:"w-full flex items-center gap-2 px-4 py-2.5 text-left transition-colors ".concat(a==="channel:".concat(e.id)?"bg-accent/10 border-r-2 border-accent":"hover:bg-bg-hover"),children:[(0,s.jsx)(q.Z,{className:"w-4 h-4 text-cyan shrink-0"}),(0,s.jsxs)("div",{className:"min-w-0",children:[(0,s.jsx)("p",{className:"text-sm text-text truncate",children:e.name}),(0,s.jsx)("p",{className:"text-[10px] text-text-muted font-mono truncate",children:g.shortenKey(e.id)})]})]},e.id))})]})]}),(0,s.jsx)(J.M,{children:r&&(0,s.jsx)(ed,{onClose:()=>l(!1),title:"Add Contact",children:(0,s.jsxs)("div",{className:"space-y-3",children:[(0,s.jsx)("input",{value:x,onChange:e=>p(e.target.value),placeholder:"Public key (64 hex)",className:"w-full bg-bg-tertiary border border-border rounded-lg px-3 py-2.5 text-sm text-text font-mono placeholder:text-text-muted focus:outline-none focus:border-accent/50"}),(0,s.jsx)("input",{value:b,onChange:e=>f(e.target.value),placeholder:"Display name (optional)",className:"w-full bg-bg-tertiary border border-border rounded-lg px-3 py-2.5 text-sm text-text placeholder:text-text-muted focus:outline-none focus:border-accent/50"}),eu&&(0,s.jsx)("p",{className:"text-red text-xs",children:eu}),(0,s.jsx)("button",{onClick:()=>{em("");let e=x.trim();if(!g.isValidHexKey(e)){em("Invalid public key. Expected 64-char hex.");return}if(e===g.publicKey){em("You cannot add yourself.");return}!function(e,t){if(y.contacts.find(t=>t.pubkey===e))return;let a={pubkey:e,name:t||g.shortenKey(e),unread:0};y={...y,contacts:[...y.contacts,a]},D(),g.requestProfile(e),v()}(e,b.trim()||void 0),p(""),f(""),l(!1)},className:"w-full px-4 py-3 bg-accent hover:bg-accent-hover text-white rounded-lg text-sm font-medium transition-colors",children:"Add"})]})})}),(0,s.jsx)(J.M,{children:u&&(0,s.jsx)(ed,{onClose:()=>m(!1),title:"Create Channel",children:(0,s.jsxs)("div",{className:"space-y-3",children:[(0,s.jsx)("input",{value:w,onChange:e=>j(e.target.value),placeholder:"Channel name",className:"w-full bg-bg-tertiary border border-border rounded-lg px-3 py-2.5 text-sm text-text placeholder:text-text-muted focus:outline-none focus:border-accent/50"}),(0,s.jsx)("textarea",{value:_,onChange:e=>M(e.target.value),rows:3,placeholder:"About channel",className:"w-full bg-bg-tertiary border border-border rounded-lg px-3 py-2.5 text-sm text-text placeholder:text-text-muted focus:outline-none focus:border-accent/50 resize-none"}),(0,s.jsx)("button",{onClick:ep,className:"w-full px-4 py-3 bg-cyan/20 hover:bg-cyan/30 text-cyan rounded-lg text-sm font-medium transition-colors",children:"Create"})]})})}),(0,s.jsx)(J.M,{children:d&&(0,s.jsx)(ed,{onClose:()=>h(!1),title:"My Profile",children:(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsx)("div",{className:"flex flex-col items-center",children:(0,s.jsxs)("div",{className:"relative group",children:[(0,s.jsx)(el,{pubkey:g.publicKey,name:W,picture:ei,size:"xl",showBorder:!0}),(0,s.jsxs)("label",{className:"absolute inset-0 flex items-center justify-center bg-black/50 rounded-full opacity-0 group-hover:opacity-100 transition-opacity cursor-pointer",children:[(0,s.jsx)($.Z,{className:"w-6 h-6 text-white"}),(0,s.jsx)("input",{type:"file",accept:"image/*",className:"hidden",onChange:e=>{var t;let a=null===(t=e.target.files)||void 0===t?void 0:t[0];if(!a||a.size>204800)return;let s=new FileReader;s.onload=()=>er(s.result),s.readAsDataURL(a)}})]})]})}),(0,s.jsx)("input",{value:W,onChange:e=>B(e.target.value),placeholder:"Name",className:"w-full bg-bg-tertiary border border-border rounded-lg px-3 py-2.5 text-sm text-text placeholder:text-text-muted focus:outline-none focus:border-accent/50"}),(0,s.jsx)("textarea",{value:es,onChange:e=>en(e.target.value),rows:2,placeholder:"About",className:"w-full bg-bg-tertiary border border-border rounded-lg px-3 py-2.5 text-sm text-text placeholder:text-text-muted focus:outline-none focus:border-accent/50 resize-none"}),(0,s.jsx)("input",{value:ei,onChange:e=>er(e.target.value),placeholder:"Avatar URL",className:"w-full bg-bg-tertiary border border-border rounded-lg px-3 py-2.5 text-sm text-text placeholder:text-text-muted focus:outline-none focus:border-accent/50"}),(0,s.jsx)("button",{onClick:eg,disabled:ec,className:"w-full px-4 py-3 bg-accent hover:bg-accent-hover disabled:opacity-50 text-white rounded-lg text-sm font-medium transition-colors",children:ec?"Saving...":"Save"})]})})}),(0,s.jsx)(J.M,{children:c&&(0,s.jsx)(ed,{onClose:()=>o(!1),title:"Settings",children:(0,s.jsxs)("div",{className:"space-y-4 max-h-[70vh] overflow-y-auto",children:[(0,s.jsxs)("div",{children:[(0,s.jsxs)("label",{className:"text-xs text-text-muted uppercase tracking-wider mb-2 block flex items-center gap-1.5",children:[(0,s.jsx)(ee.Z,{className:"w-3 h-3"})," Relays"]}),(0,s.jsx)("div",{className:"space-y-1 mb-2",children:g.relays.map(e=>(0,s.jsxs)("div",{className:"flex items-center justify-between px-3 py-2 bg-bg-tertiary rounded-lg",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)("div",{className:"w-2 h-2 rounded-full ".concat("connected"===g.getRelayStatus(e)?"bg-green":"connecting"===g.getRelayStatus(e)?"bg-yellow":"bg-red")}),(0,s.jsx)("span",{className:"text-xs text-text-secondary font-mono",children:e.replace("wss://","")})]}),(0,s.jsx)("button",{onClick:()=>{g.removeRelay(e),ex(e=>e+1)},className:"text-text-muted hover:text-red transition-colors",children:(0,s.jsx)(et.Z,{className:"w-3 h-3"})})]},e))}),(0,s.jsxs)("div",{className:"flex gap-2",children:[(0,s.jsx)("input",{value:I,onChange:e=>A(e.target.value),onKeyDown:e=>"Enter"===e.key&&ey(),placeholder:"wss://relay.example.com",className:"flex-1 bg-bg-tertiary border border-border rounded-lg px-3 py-2 text-xs text-text font-mono placeholder:text-text-muted focus:outline-none focus:border-accent/50"}),(0,s.jsx)("button",{onClick:ey,className:"px-3 py-2 bg-accent hover:bg-accent-hover text-white rounded-lg text-xs transition-colors",children:"+"})]})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"text-xs text-text-muted uppercase tracking-wider mb-1 block",children:"Public key"}),(0,s.jsx)("div",{className:"bg-bg-tertiary rounded-lg p-3 text-xs text-text-secondary font-mono break-all",children:g.publicKey})]}),(0,s.jsxs)("button",{onClick:()=>{g.logout(),C(!1)},className:"w-full flex items-center justify-center gap-2 px-4 py-3 bg-red-dim hover:bg-red/20 border border-red/20 text-red rounded-lg text-sm transition-colors",children:[(0,s.jsx)(ea.Z,{className:"w-4 h-4"})," Logout"]})]})})})]}):(0,s.jsx)("button",{onClick:S,className:"fixed top-4 left-4 z-50 lg:hidden bg-bg-secondary border border-border rounded-lg p-2 text-text-secondary hover:text-text",children:(0,s.jsx)(H.Z,{className:"w-5 h-5"})})}function eo(e){let{contact:t,isActive:a,onClick:n,onRemove:i}=e;return(0,s.jsxs)("div",{className:"group flex items-center gap-3 px-4 py-3 cursor-pointer transition-colors relative ".concat(a?"bg-accent/10 border-r-2 border-accent":"hover:bg-bg-hover"),onClick:n,children:[(0,s.jsx)(el,{pubkey:t.pubkey,name:t.name,picture:t.picture,size:"md",showBorder:!0}),(0,s.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsx)("span",{className:"text-sm font-medium text-text truncate",children:t.name||g.shortenKey(t.pubkey)}),t.lastMessageTime&&(0,s.jsx)("span",{className:"text-[10px] text-text-muted shrink-0 ml-2",children:function(e){let t=new Date(e),a=new Date,s=a.getTime()-t.getTime();return s<864e5&&t.getDate()===a.getDate()?t.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}):s<6048e5?t.toLocaleDateString("en-US",{weekday:"short"}):t.toLocaleDateString("en-US",{month:"short",day:"numeric"})}(t.lastMessageTime)})]}),(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsx)("span",{className:"text-xs text-text-muted truncate",children:t.lastMessage||g.shortenKey(t.pubkey)}),(t.unread||0)>0&&(0,s.jsx)("span",{className:"ml-2 shrink-0 bg-accent text-white text-[10px] font-bold rounded-full w-5 h-5 flex items-center justify-center",children:t.unread})]})]}),(0,s.jsx)("button",{onClick:e=>{e.stopPropagation(),i()},className:"absolute right-2 top-1/2 -translate-y-1/2 p-1.5 rounded-lg bg-red-dim text-red opacity-0 group-hover:opacity-100 hover:bg-red/20 transition-all",title:"Remove",children:(0,s.jsx)(es.Z,{className:"w-3 h-3"})})]})}function ed(e){let{children:t,onClose:a,title:n}=e;return(0,s.jsx)(Z.E.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 z-50 flex items-center justify-center bg-black/60 backdrop-blur-sm p-4",onClick:a,children:(0,s.jsxs)(Z.E.div,{initial:{scale:.95,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.95,opacity:0},onClick:e=>e.stopPropagation(),className:"w-full max-w-md bg-bg-secondary border border-border rounded-xl p-5",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,s.jsx)("h3",{className:"text-lg font-bold text-text",style:{fontFamily:"Space Grotesk"},children:n}),(0,s.jsx)("button",{onClick:a,className:"p-1 rounded-lg hover:bg-bg-hover text-text-secondary",children:(0,s.jsx)(et.Z,{className:"w-5 h-5"})})]}),t]})})}var eh=a(6840),eu=a(3041),em=a(9374),ex=a(2735),ep=a(8098),eb=a(1817),eg=a(3113),ey=a(6980),ef=a(4743);let ev=["image/jpeg","image/png","image/gif","image/webp","image/svg+xml"];function ew(e){return e<1024?"".concat(e," B"):e<1048576?"".concat((e/1024).toFixed(1)," KB"):e<1073741824?"".concat((e/1048576).toFixed(1)," MB"):"".concat((e/1073741824).toFixed(2)," GB")}async function ej(e){var t;if(e.size>2147483648)throw Error("File is too large. Maximum: ".concat(ew(2147483648),"."));let a=(t=e.type,ev.includes(t)),s=a?"image/jpeg":e.type||"application/octet-stream";if(e.size>8388608)return{type:a?"image":"file",name:e.name,mimeType:s,data:"",size:e.size,file:e,chunked:!0};let n=a&&e.size>204800?await new Promise((t,a)=>{let s=new window.Image,n=URL.createObjectURL(e);s.onload=()=>{URL.revokeObjectURL(n);let e=s.width,i=s.height;if(e>2048||i>2048){let t=Math.min(2048/e,2048/i);e=Math.round(e*t),i=Math.round(i*t)}let r=document.createElement("canvas");r.width=e,r.height=i;let l=r.getContext("2d");if(!l)return a(Error("Canvas context unavailable"));l.drawImage(s,0,0,e,i),t(r.toDataURL("image/jpeg",.82).split(",")[1])},s.onerror=a,s.src=n}):await new Promise((t,a)=>{let s=new FileReader;s.onload=()=>{t(s.result.split(",")[1])},s.onerror=a,s.readAsDataURL(e)});return{type:a?"image":"file",name:e.name,mimeType:s,data:n,size:e.size,file:e}}function eN(e){return e.startsWith("image/")?"\uD83D\uDDBC️":e.startsWith("video/")?"\uD83C\uDFAC":e.startsWith("audio/")?"\uD83C\uDFB5":e.includes("pdf")?"\uD83D\uDCC4":e.includes("zip")||e.includes("rar")||e.includes("tar")?"\uD83D\uDCE6":e.includes("text")?"\uD83D\uDCDD":e.includes("json")||e.includes("xml")?"⚙️":"\uD83D\uDCCE"}let ek={iceServers:[{urls:"stun:stun.l.google.com:19302"},{urls:"stun:stun1.l.google.com:19302"},{urls:"stun:stun.cloudflare.com:3478"},{urls:"turn:openrelay.metered.ca:80",username:"openrelayproject",credential:"openrelayproject"},{urls:"turn:openrelay.metered.ca:443",username:"openrelayproject",credential:"openrelayproject"},{urls:"turn:openrelay.metered.ca:443?transport=tcp",username:"openrelayproject",credential:"openrelayproject"}],iceCandidatePoolSize:10};class eC{get callState(){return this._callState}get remotePubkey(){return this._remotePubkey}get callType(){return this._callType}get callStartTime(){return this._callStartTime}onStateChange(e){return this.stateCallbacks.add(e),()=>{this.stateCallbacks.delete(e)}}onStream(e){return this.streamCallbacks.add(e),()=>{this.streamCallbacks.delete(e)}}setState(e,t){this._callState=e,"connected"===e&&(this._callStartTime=Date.now(),this.stopRingtone()),("idle"===e||"ended"===e)&&this.stopRingtone(),this.stateCallbacks.forEach(a=>a(e,this._remotePubkey,this._callType,t))}notifyStreams(){this.streamCallbacks.forEach(e=>e(this.localStream,this.remoteStream))}playRingtone(){this.stopRingtone();try{this.audioCtx=new AudioContext,this.audioOsc=this.audioCtx.createOscillator();let e=this.audioCtx.createGain();this.audioOsc.connect(e),e.connect(this.audioCtx.destination),this.audioOsc.frequency.value=440,e.gain.value=.08,this.audioOsc.start();let t=this.audioCtx,a=()=>{if("ringing"!==this._callState||!this.audioCtx){try{var s;null===(s=this.audioOsc)||void 0===s||s.stop(),t.close()}catch(e){}return}e.gain.setValueAtTime(.08,t.currentTime),e.gain.exponentialRampToValueAtTime(.001,t.currentTime+.5),setTimeout(a,1200)};a()}catch(e){}}stopRingtone(){var e,t;try{null===(e=this.audioOsc)||void 0===e||e.stop()}catch(e){}try{null===(t=this.audioCtx)||void 0===t||t.close()}catch(e){}this.audioOsc=null,this.audioCtx=null}init(){this._unsubSignal||(this._unsubSignal=g.onSignal((e,t)=>{this.handleSignal(e,t)}))}destroy(){this._unsubSignal&&(this._unsubSignal(),this._unsubSignal=null),this.cleanup(!1)}async handleSignal(e,t){switch(t.type){case"call-request":if("idle"!==this._callState){g.sendWebRTCSignal(e,{type:"call-reject"}).catch(()=>{});return}this._remotePubkey=e,this._callType=t.callType||"audio",this.setState("ringing"),this.playRingtone(),this.callTimeout=setTimeout(()=>{"ringing"===this._callState&&this.rejectCall()},45e3);break;case"call-accept":"calling"===this._callState&&this._remotePubkey===e&&(this.clearRetry(),this.clearCallTimeout(),this.setState("connecting"),await this.startWebRTC(!0));break;case"call-reject":this._remotePubkey===e&&(this.cleanup(!1),this.setState("idle","Звонок отклонён"));break;case"call-end":this._remotePubkey===e&&this.cleanup(!1);break;case"webrtc-offer":this._remotePubkey===e&&t.sdp&&await this.handleOffer(t.sdp);break;case"webrtc-answer":this._remotePubkey===e&&t.sdp&&await this.handleAnswer(t.sdp);break;case"webrtc-ice":this._remotePubkey===e&&t.candidate&&await this.handleIceCandidate(t.candidate)}}clearCallTimeout(){this.callTimeout&&(clearTimeout(this.callTimeout),this.callTimeout=null)}clearRetry(){this.retryInterval&&(clearInterval(this.retryInterval),this.retryInterval=null)}async initiateCall(e,t){if("idle"!==this._callState)return;try{this.preStream=await navigator.mediaDevices.getUserMedia({audio:{echoCancellation:!0,noiseSuppression:!0,autoGainControl:!0},video:"video"===t&&{width:{ideal:1280},height:{ideal:720},facingMode:"user"}})}catch(e){if("video"===t)try{this.preStream=await navigator.mediaDevices.getUserMedia({audio:!0,video:!1}),t="audio"}catch(t){this.setState("idle",this.mediaErrorMsg(e));return}else{this.setState("idle",this.mediaErrorMsg(e));return}}this._remotePubkey=e,this._callType=t,this.setState("calling");let a=()=>{g.sendWebRTCSignal(e,{type:"call-request",callType:t}).catch(()=>{})};a(),this.retryInterval=setInterval(()=>{"calling"===this._callState?a():this.clearRetry()},3e3),this.callTimeout=setTimeout(()=>{"calling"===this._callState&&(this.cleanup(!0),this.setState("idle","Нет ответа"))},4e4)}async acceptCall(){if("ringing"===this._callState&&this._remotePubkey){this.clearCallTimeout(),this.stopRingtone(),this.setState("connecting");try{this.preStream=await navigator.mediaDevices.getUserMedia({audio:{echoCancellation:!0,noiseSuppression:!0,autoGainControl:!0},video:"video"===this._callType&&{width:{ideal:1280},height:{ideal:720},facingMode:"user"}})}catch(e){if("video"===this._callType)try{this.preStream=await navigator.mediaDevices.getUserMedia({audio:!0}),this._callType="audio"}catch(t){this.cleanup(!1),this.setState("idle",this.mediaErrorMsg(e));return}else{this.cleanup(!1),this.setState("idle",this.mediaErrorMsg(e));return}}await g.sendWebRTCSignal(this._remotePubkey,{type:"call-accept"}),await this.startWebRTC(!1)}}async rejectCall(){"ringing"===this._callState&&this._remotePubkey&&(this.clearCallTimeout(),this.stopRingtone(),g.sendWebRTCSignal(this._remotePubkey,{type:"call-reject"}).catch(()=>{}),this.cleanup(!1))}mediaErrorMsg(e){return e instanceof DOMException?"NotAllowedError"===e.name?"Доступ к микрофону/камере запрещён. Разрешите в настройках браузера.":"NotFoundError"===e.name?"Микрофон/камера не найдены. Подключите устройство.":"NotReadableError"===e.name?"Устройство занято другим приложением.":"Ошибка: ".concat(e.message):"Не удалось получить доступ к медиа"}async startWebRTC(e){try{if(this.pc=new RTCPeerConnection(ek),this.localStream=this.preStream,this.preStream=null,this.localStream||(this.localStream=await navigator.mediaDevices.getUserMedia({audio:!0,video:"video"===this._callType})),this.localStream.getTracks().forEach(e=>{this.pc.addTrack(e,this.localStream)}),this.remoteStream=new MediaStream,this.pc.ontrack=e=>{e.streams[0]?e.streams[0].getTracks().forEach(e=>{this.remoteStream.addTrack(e)}):e.track&&this.remoteStream.addTrack(e.track),this.notifyStreams()},this.pc.onicecandidate=e=>{e.candidate&&this._remotePubkey&&g.sendWebRTCSignal(this._remotePubkey,{type:"webrtc-ice",candidate:e.candidate.toJSON()}).catch(()=>{})},this.pc.oniceconnectionstatechange=()=>{var t;let a=null===(t=this.pc)||void 0===t?void 0:t.iceConnectionState;if("connected"===a||"completed"===a)this.setState("connected");else if("failed"===a){if(this.pc&&e)try{this.pc.restartIce()}catch(e){this.endCall("Соединение прервано")}else this.endCall("Соединение прервано")}else"disconnected"===a&&setTimeout(()=>{var e;(null===(e=this.pc)||void 0===e?void 0:e.iceConnectionState)==="disconnected"&&this.endCall("Соединение потеряно")},7e3)},this.notifyStreams(),e){let e=await this.pc.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:"video"===this._callType});await this.pc.setLocalDescription(e),await g.sendWebRTCSignal(this._remotePubkey,{type:"webrtc-offer",sdp:e.sdp})}for(let e of this.iceCandidateQueue)try{await this.pc.addIceCandidate(new RTCIceCandidate(e))}catch(e){}this.iceCandidateQueue=[]}catch(e){this.endCall(this.mediaErrorMsg(e))}}async handleOffer(e){if(this.pc)try{await this.pc.setRemoteDescription(new RTCSessionDescription({type:"offer",sdp:e}));let t=await this.pc.createAnswer();await this.pc.setLocalDescription(t),await g.sendWebRTCSignal(this._remotePubkey,{type:"webrtc-answer",sdp:t.sdp})}catch(e){console.error("handleOffer:",e)}}async handleAnswer(e){if(this.pc)try{await this.pc.setRemoteDescription(new RTCSessionDescription({type:"answer",sdp:e}))}catch(e){console.error("handleAnswer:",e)}}async handleIceCandidate(e){if(!this.pc||!this.pc.remoteDescription){this.iceCandidateQueue.push(e);return}try{await this.pc.addIceCandidate(new RTCIceCandidate(e))}catch(e){}}endCall(e){this._remotePubkey&&"idle"!==this._callState&&"ended"!==this._callState&&g.sendWebRTCSignal(this._remotePubkey,{type:"call-end"}).catch(()=>{}),this.cleanup(!1),e&&this.setState("idle",e)}cleanup(e){this.clearCallTimeout(),this.clearRetry(),this.stopRingtone(),this.preStream&&(this.preStream.getTracks().forEach(e=>e.stop()),this.preStream=null),this.localStream&&(this.localStream.getTracks().forEach(e=>e.stop()),this.localStream=null),this.remoteStream&&(this.remoteStream.getTracks().forEach(e=>e.stop()),this.remoteStream=null),this.pc&&(this.pc.close(),this.pc=null),this.iceCandidateQueue=[],this._remotePubkey=null,this._callStartTime=0,e||this.setState("idle"),this.notifyStreams()}toggleMute(){if(!this.localStream)return!1;let e=this.localStream.getAudioTracks()[0];return!!e&&(e.enabled=!e.enabled,!e.enabled)}toggleVideo(){if(!this.localStream)return!1;let e=this.localStream.getVideoTracks()[0];return!!e&&(e.enabled=!e.enabled,!e.enabled)}constructor(){this.pc=null,this.localStream=null,this.remoteStream=null,this._callState="idle",this._remotePubkey=null,this._callType="audio",this.stateCallbacks=new Set,this.streamCallbacks=new Set,this.iceCandidateQueue=[],this._callStartTime=0,this._unsubSignal=null,this.callTimeout=null,this.retryInterval=null,this.audioCtx=null,this.audioOsc=null,this.preStream=null}}let eS=new eC;function eT(e){let{text:t,highlight:a}=e;if(!a.trim())return(0,s.jsx)("span",{children:t});let n=RegExp("(".concat(a,")"),"gi"),i=t.split(n);return(0,s.jsx)("span",{children:i.map((e,t)=>n.test(e)?(0,s.jsx)("mark",{className:"bg-yellow-300 text-black rounded-sm",children:e},t):(0,s.jsx)("span",{children:e},t))})}function e_(){let{activeChat:e,contacts:t,channels:a}=N(),i=!!e&&e.startsWith("channel:"),r=i?e.slice(8):"",[l,c]=(0,n.useState)(""),[o,d]=(0,n.useState)(!1),[h,u]=(0,n.useState)([]),[m,p]=(0,n.useState)(null),[b,y]=(0,n.useState)(null),[f,v]=(0,n.useState)(null),[w,j]=(0,n.useState)(null),[k,C]=(0,n.useState)(""),[E,D]=(0,n.useState)(""),[z,O]=(0,n.useState)(""),[I,A]=(0,n.useState)(!1),K=(0,n.useRef)(null),L=(0,n.useRef)(null),W=(0,n.useRef)(null),B=(0,n.useRef)(null),H=(0,n.useMemo)(()=>t.find(t=>t.pubkey===e),[t,e]),V=(0,n.useMemo)(()=>a.find(e=>e.id===r),[a,r]);(0,n.useEffect)(()=>{if(I){var e;null===(e=B.current)||void 0===e||e.focus()}},[I]);let G=(0,n.useMemo)(()=>z.trim()?h.filter(e=>{var t;return null===(t=e.content)||void 0===t?void 0:t.toLowerCase().includes(z.toLowerCase())}):h,[h,z]);(0,n.useEffect)(()=>{e&&(i?u(R(r)):(u(P(e)),g.requestProfile(e)),p(null),y(null),v(null),C(""))},[e,i,r]),(0,n.useEffect)(()=>{let t=g.onMessage(t=>{_(t),e&&!i&&u(P(e))}),a=g.onChannelMessage(e=>{M(e),r&&i&&e.channelId===r&&u(R(r))});return()=>{t(),a()}},[e,i,r]),(0,n.useEffect)(()=>g.onProfile((e,t)=>{T(e,t.name,t.picture,t.about)}),[]),(0,n.useEffect)(()=>{e&&u(i?R(r):P(e))},[e,t,a,i,r]),(0,n.useEffect)(()=>{var e;z||null===(e=K.current)||void 0===e||e.scrollIntoView({behavior:"smooth"})},[h,z]);let Q=async()=>{if(!l.trim()&&!m||!e||o)return;let t=l.trim();c(""),d(!0),C(""),y(null);try{if(i){if(m)throw Error("Attachments are not supported in public channels.");let e=await g.sendChannelMessage(r,t,f||void 0);M(e),u(R(r))}else if(m){let a=await g.sendAttachment(e,m,t,(e,t)=>y({sent:e,total:t}),f||void 0);_(a),u(P(e)),p(null)}else{let a=await g.sendDirectMessage(e,t,f||void 0);_(a),u(P(e))}v(null),y(null)}catch(e){C(e.message||"Failed to send")}finally{d(!1)}},Y=(0,n.useCallback)(t=>{e&&!i&&eS.initiateCall(e,t)},[e,i]),$=(0,n.useCallback)(async e=>{var t;let a=null===(t=e.target.files)||void 0===t?void 0:t[0];if(a){e.target.value="",C("");try{let e=await ej(a);e&&p(e)}catch(e){C(e.message)}}},[]),ee=async(e,t)=>{await navigator.clipboard.writeText(e),D(t),setTimeout(()=>D(""),1400)},ea=async e=>{if(e.attachment){if(e.attachment.chunked&&e.attachment.transferId){await x(e.attachment.transferId,e.attachment.name,e.attachment.mimeType);return}!function(e){let t=function(e,t){let a=atob(e),s=new Uint8Array(a.length);for(let e=0;e<a.length;e++)s[e]=a.charCodeAt(e);return new Blob([s.buffer],{type:t})}(e.data,e.mimeType),a=URL.createObjectURL(t),s=document.createElement("a");s.href=a,s.download=e.name,document.body.appendChild(s),s.click(),document.body.removeChild(s),URL.revokeObjectURL(a)}(e.attachment)}};return e?(0,s.jsxs)("div",{className:"flex-1 flex flex-col bg-bg h-full",children:[(0,s.jsxs)("div",{className:"px-4 py-3 border-b border-border bg-bg-secondary/50 backdrop-blur-sm flex items-center gap-3",children:[(0,s.jsx)("button",{onClick:S,className:"p-2 rounded-lg hover:bg-bg-hover text-text-secondary lg:hidden",children:(0,s.jsx)(eh.Z,{className:"w-5 h-5"})}),i?(0,s.jsx)("div",{className:"w-8 h-8 rounded-full bg-cyan/15 border border-cyan/25 flex items-center justify-center",children:(0,s.jsx)(q.Z,{className:"w-4 h-4 text-cyan"})}):(0,s.jsx)(el,{pubkey:e,name:null==H?void 0:H.name,picture:null==H?void 0:H.picture,size:"sm",showBorder:!0}),(0,s.jsx)("div",{className:"flex-1 min-w-0",children:(0,s.jsx)(J.M,{initial:!1,mode:"wait",children:(0,s.jsx)(Z.E.div,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},exit:{opacity:0,y:10},transition:{duration:.2},className:"w-full",children:I?(0,s.jsxs)("div",{className:"relative w-full",children:[(0,s.jsx)(X.Z,{className:"absolute left-2 top-1/2 -translate-y-1/2 w-4 h-4 text-text-muted"}),(0,s.jsx)("input",{ref:B,type:"text",value:z,onChange:e=>O(e.target.value),placeholder:"Search in chat...",className:"w-full bg-bg-tertiary border border-border rounded-lg pl-8 pr-8 py-1 text-sm text-text placeholder:text-text-muted focus:outline-none focus:border-accent/50"}),(0,s.jsx)("button",{onClick:()=>{A(!1),O("")},className:"absolute right-2 top-1/2 -translate-y-1/2 p-0.5 text-text-muted hover:text-text",children:(0,s.jsx)(et.Z,{className:"w-4 h-4"})})]}):(0,s.jsxs)("div",{children:[(0,s.jsx)("div",{className:"text-sm font-medium text-text truncate",children:i?"# ".concat((null==V?void 0:V.name)||g.shortenKey(r)):(null==H?void 0:H.name)||g.shortenKey(e)}),(0,s.jsx)("div",{className:"text-[10px] text-text-muted",children:i?"Public channel over relays":"Encrypted DM over relays"})]})},I?"search":"title")})}),(0,s.jsxs)("div",{className:"flex items-center gap-1",children:[(0,s.jsx)("button",{onClick:()=>A(!I),className:"p-2 rounded-lg hover:bg-bg-hover transition-colors ".concat(I?"bg-bg-tertiary text-accent":"text-text-muted hover:text-text-secondary"),title:"Search",children:(0,s.jsx)(X.Z,{className:"w-4 h-4"})}),!i&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("button",{onClick:()=>Y("audio"),className:"p-2 rounded-lg hover:bg-bg-hover text-text-muted hover:text-green transition-colors",title:"Audio call",children:(0,s.jsx)(eu.Z,{className:"w-4 h-4"})}),(0,s.jsx)("button",{onClick:()=>Y("video"),className:"p-2 rounded-lg hover:bg-bg-hover text-text-muted hover:text-accent transition-colors",title:"Video call",children:(0,s.jsx)(em.Z,{className:"w-4 h-4"})}),(0,s.jsx)("button",{onClick:()=>ee(e,"header"),className:"p-2 rounded-lg hover:bg-bg-hover text-text-muted hover:text-text-secondary transition-colors",title:"Copy key",children:"header"===E?(0,s.jsx)(F.Z,{className:"w-4 h-4 text-green"}):(0,s.jsx)(U.Z,{className:"w-4 h-4"})})]})]})]}),(0,s.jsxs)("div",{className:"flex-1 overflow-y-auto px-4 py-4 space-y-2",children:[G.map(e=>{let t=e.from===g.publicKey;return(0,s.jsx)(Z.E.div,{initial:{opacity:0,y:8},animate:{opacity:1,y:0},className:"flex ".concat(t?"justify-end":"justify-start"),children:(0,s.jsxs)("div",{className:"group relative max-w-[78%] rounded-2xl text-sm overflow-hidden ".concat(t?"bg-accent text-white rounded-br-md":"bg-bg-secondary border border-border text-text rounded-bl-md"),children:[e.replyTo&&(0,s.jsxs)("div",{className:"mx-2 mt-2 px-2 py-1 rounded-md text-[11px] ".concat(t?"bg-white/15 text-white/80":"bg-bg-tertiary text-text-secondary"),children:[(0,s.jsx)("p",{className:"font-medium truncate",children:e.replyTo.from===g.publicKey?"You":g.shortenKey(e.replyTo.from)}),(0,s.jsx)("p",{className:"truncate",children:e.replyTo.text})]}),"image"===e.msgType&&e.attachment&&!e.attachment.chunked&&(0,s.jsx)("div",{className:"cursor-pointer",onClick:()=>j("data:".concat(e.attachment.mimeType,";base64,").concat(e.attachment.data)),children:(0,s.jsx)(en.default,{src:"data:".concat(e.attachment.mimeType,";base64,").concat(e.attachment.data),alt:e.attachment.name,width:300,height:200,className:"max-w-full max-h-64 rounded-t-2xl object-cover"})}),e.attachment&&"file"===e.msgType&&(0,s.jsxs)("div",{className:"flex items-center gap-3 px-3.5 pt-3 cursor-pointer",onClick:()=>ea(e),children:[(0,s.jsx)("div",{className:"w-10 h-10 rounded-xl flex items-center justify-center text-lg ".concat(t?"bg-white/15":"bg-bg-tertiary"),children:eN(e.attachment.mimeType)}),(0,s.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,s.jsx)("p",{className:"text-xs font-medium truncate ".concat(t?"text-white":"text-text"),children:e.attachment.name}),(0,s.jsx)("p",{className:"text-[10px] ".concat(t?"text-white/60":"text-text-muted"),children:ew(e.attachment.size)})]}),(0,s.jsx)(ex.Z,{className:"w-4 h-4 shrink-0 ".concat(t?"text-white/60":"text-text-muted")})]}),e.attachment&&"image"===e.msgType&&e.attachment.chunked&&(0,s.jsxs)("div",{className:"flex items-center gap-3 px-3.5 pt-3 cursor-pointer",onClick:()=>ea(e),children:[(0,s.jsx)("div",{className:"w-10 h-10 rounded-xl flex items-center justify-center text-lg ".concat(t?"bg-white/15":"bg-bg-tertiary"),children:"\uD83D\uDDBC️"}),(0,s.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,s.jsx)("p",{className:"text-xs font-medium truncate ".concat(t?"text-white":"text-text"),children:e.attachment.name}),(0,s.jsx)("p",{className:"text-[10px] ".concat(t?"text-white/60":"text-text-muted"),children:"Chunked image, click to download"})]}),(0,s.jsx)(ex.Z,{className:"w-4 h-4 shrink-0 ".concat(t?"text-white/60":"text-text-muted")})]}),e.content&&(0,s.jsx)("div",{className:"px-3.5 py-2.5",children:(0,s.jsx)("p",{className:"whitespace-pre-wrap break-words",children:(0,s.jsx)(eT,{text:e.content,highlight:z})})}),(0,s.jsx)("div",{className:"flex items-center gap-1 px-3.5 pb-2 ".concat(t?"justify-end":"justify-start"),children:(0,s.jsx)("span",{className:"text-[10px] ".concat(t?"text-white/50":"text-text-muted"),children:new Date(e.timestamp).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})})}),(0,s.jsxs)("div",{className:"absolute top-1 ".concat(t?"left-0 -translate-x-9":"right-0 translate-x-9"," flex flex-col gap-1 opacity-0 group-hover:opacity-100 transition-opacity"),children:[e.content&&(0,s.jsx)("button",{onClick:()=>ee(e.content,e.id),className:"p-1 rounded bg-bg-secondary border border-border",children:E===e.id?(0,s.jsx)(F.Z,{className:"w-3 h-3 text-green"}):(0,s.jsx)(U.Z,{className:"w-3 h-3 text-text-muted"})}),(0,s.jsx)("button",{onClick:()=>{var t;return v({id:e.id,from:e.from,text:e.content||(null===(t=e.attachment)||void 0===t?void 0:t.name)||""})},className:"p-1 rounded bg-bg-secondary border border-border",children:(0,s.jsx)(ep.Z,{className:"w-3 h-3 text-text-muted"})})]})]})},e.id)}),(0,s.jsx)("div",{ref:K})]}),(0,s.jsx)(J.M,{children:f&&(0,s.jsx)(Z.E.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},className:"px-4 py-2 border-t border-border bg-bg-secondary/40 overflow-hidden",children:(0,s.jsxs)("div",{className:"flex items-start justify-between gap-3",children:[(0,s.jsxs)("div",{className:"min-w-0",children:[(0,s.jsxs)("p",{className:"text-[11px] text-text-muted",children:["Reply to ",f.from===g.publicKey?"you":g.shortenKey(f.from)]}),(0,s.jsx)("p",{className:"text-xs text-text-secondary truncate",children:f.text||"(attachment)"})]}),(0,s.jsx)("button",{onClick:()=>v(null),className:"p-1.5 rounded hover:bg-bg-hover",children:(0,s.jsx)(et.Z,{className:"w-3.5 h-3.5 text-text-muted"})})]})})}),(0,s.jsx)(J.M,{children:m&&(0,s.jsx)(Z.E.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},className:"px-4 border-t border-border bg-bg-secondary/30 overflow-hidden",children:(0,s.jsxs)("div",{className:"py-3 flex items-center gap-3",children:["image"===m.type&&m.data?(0,s.jsx)("div",{className:"w-16 h-16 rounded-xl overflow-hidden border border-border shrink-0",children:(0,s.jsx)(en.default,{src:"data:".concat(m.mimeType,";base64,").concat(m.data),alt:"Attachment preview",width:64,height:64,className:"w-full h-full object-cover"})}):(0,s.jsx)("div",{className:"w-16 h-16 rounded-xl bg-bg-tertiary border border-border flex items-center justify-center text-2xl shrink-0",children:eN(m.mimeType)}),(0,s.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,s.jsx)("p",{className:"text-sm text-text truncate",children:m.name}),(0,s.jsx)("p",{className:"text-xs text-text-muted",children:ew(m.size)})]}),(0,s.jsx)("button",{onClick:()=>p(null),className:"p-2 rounded-lg hover:bg-bg-hover text-text-muted hover:text-red transition-colors",children:(0,s.jsx)(et.Z,{className:"w-4 h-4"})})]})})}),(0,s.jsx)(J.M,{children:b&&(0,s.jsx)(Z.E.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},className:"px-4 border-t border-border bg-bg-secondary/30 overflow-hidden",children:(0,s.jsxs)("div",{className:"py-2",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between text-xs text-text-secondary mb-1",children:[(0,s.jsxs)("span",{className:"flex items-center gap-1.5",children:[(0,s.jsx)(eb.Z,{className:"w-3 h-3 animate-spin"}),"Uploading..."]}),(0,s.jsxs)("span",{children:[b.sent,"/",b.total," chunks"]})]}),(0,s.jsx)("div",{className:"w-full h-1.5 bg-bg-tertiary rounded-full overflow-hidden",children:(0,s.jsx)(Z.E.div,{className:"h-full bg-accent rounded-full",initial:{width:0},animate:{width:"".concat(b.sent/b.total*100,"%")},transition:{duration:.2}})})]})})}),(0,s.jsx)(J.M,{children:k&&(0,s.jsx)(Z.E.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},className:"px-4 py-2 bg-red-dim border-t border-red/20",children:(0,s.jsx)("p",{className:"text-xs text-red",children:k})})}),(0,s.jsx)("div",{className:"px-4 py-3 border-t border-border bg-bg-secondary/30",children:(0,s.jsxs)("div",{className:"flex items-end gap-2",children:[!i&&(0,s.jsxs)("div",{className:"flex items-center gap-0.5 pb-1",children:[(0,s.jsx)("button",{onClick:()=>{var e;return null===(e=L.current)||void 0===e?void 0:e.click()},className:"p-2 rounded-lg hover:bg-bg-hover text-text-muted hover:text-accent transition-colors",title:"Send image",disabled:o,children:(0,s.jsx)(eg.Z,{className:"w-5 h-5"})}),(0,s.jsx)("button",{onClick:()=>{var e;return null===(e=W.current)||void 0===e?void 0:e.click()},className:"p-2 rounded-lg hover:bg-bg-hover text-text-muted hover:text-accent transition-colors",title:"Send file",disabled:o,children:(0,s.jsx)(ey.Z,{className:"w-5 h-5"})})]}),(0,s.jsx)("input",{ref:L,type:"file",accept:"image/*",className:"hidden",onChange:$}),(0,s.jsx)("input",{ref:W,type:"file",className:"hidden",onChange:$}),(0,s.jsx)("textarea",{value:l,onChange:e=>c(e.target.value),onKeyDown:e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),Q())},placeholder:m?"Add caption...":i?"Post message to channel...":"Write message...",rows:1,disabled:o,className:"flex-1 bg-bg-tertiary border border-border rounded-xl px-4 py-3 text-sm text-text placeholder:text-text-muted focus:outline-none focus:border-accent/50 resize-none max-h-32 disabled:opacity-50",style:{minHeight:"44px"}}),(0,s.jsx)(Z.E.button,{whileHover:{scale:o?1:1.05},whileTap:{scale:o?1:.95},onClick:Q,disabled:!l.trim()&&!m||o,className:"p-3 bg-accent hover:bg-accent-hover disabled:opacity-30 disabled:cursor-not-allowed text-white rounded-xl transition-colors shrink-0",children:o?(0,s.jsx)(eb.Z,{className:"w-5 h-5 animate-spin"}):(0,s.jsx)(ef.Z,{className:"w-5 h-5"})})]})}),(0,s.jsx)(J.M,{children:w&&(0,s.jsxs)(Z.E.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 z-[90] flex items-center justify-center bg-black/90 backdrop-blur-sm p-4",onClick:()=>j(null),children:[(0,s.jsx)("button",{className:"absolute top-4 right-4 p-2 rounded-lg bg-white/10 text-white hover:bg-white/20 transition-colors z-10",onClick:()=>j(null),children:(0,s.jsx)(et.Z,{className:"w-6 h-6"})}),(0,s.jsx)(Z.E.div,{initial:{scale:.9},animate:{scale:1},exit:{scale:.9},className:"relative max-w-full max-h-full",onClick:e=>e.stopPropagation(),children:(0,s.jsx)(en.default,{src:w,alt:"Image preview",layout:"fill",objectFit:"contain",className:"rounded-lg"})})]})})]}):(0,s.jsx)("div",{className:"flex-1 flex items-center justify-center bg-bg",children:(0,s.jsxs)("div",{className:"text-center px-4",children:[(0,s.jsx)("h2",{className:"text-2xl font-bold text-text mb-2",style:{fontFamily:"Space Grotesk"},children:"Anonymous Decentralized Messenger"}),(0,s.jsx)("p",{className:"text-text-secondary text-sm",children:"Choose contact or channel to start."})]})})}var eE=a(6865),eM=a(6524),eR=a(7133),eP=a(730),eD=a(8662),ez=a(8178);function eZ(){let{contacts:e}=N(),[t,a]=(0,n.useState)("idle"),[i,r]=(0,n.useState)(null),[l,c]=(0,n.useState)("audio"),[o,d]=(0,n.useState)(!1),[h,u]=(0,n.useState)(!1),[m,x]=(0,n.useState)(0),[p,b]=(0,n.useState)(null),[y,f]=(0,n.useState)(null),[v,w]=(0,n.useState)(null),j=(0,n.useRef)(null),k=(0,n.useRef)(null);(0,n.useEffect)(()=>{eS.init();let e=eS.onStateChange((e,t,s,n)=>{a(e),r(t),c(s),n&&(w(n),setTimeout(()=>w(null),4e3)),"idle"===e&&(d(!1),u(!1),x(0))}),t=eS.onStream((e,t)=>{b(e),f(t)});return()=>{e(),t(),eS.destroy()}},[]),(0,n.useEffect)(()=>{j.current&&p&&(j.current.srcObject=p)},[p]),(0,n.useEffect)(()=>{k.current&&y&&(k.current.srcObject=y)},[y]),(0,n.useEffect)(()=>{if("connected"!==t)return;let e=setInterval(()=>{x(Math.floor((Date.now()-eS.callStartTime)/1e3))},1e3);return()=>clearInterval(e)},[t]);let C=(0,n.useCallback)(()=>{d(eS.toggleMute())},[]),S=(0,n.useCallback)(()=>{u(eS.toggleVideo())},[]),T=i?e.find(e=>e.pubkey===i):null,_=(null==T?void 0:T.name)||(i?g.shortenKey(i):"Неизвестный"),E=e=>"".concat(Math.floor(e/60).toString().padStart(2,"0"),":").concat((e%60).toString().padStart(2,"0"));return"idle"!==t||v?"idle"===t&&v?(0,s.jsx)(J.M,{children:(0,s.jsxs)(Z.E.div,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},className:"fixed top-4 left-1/2 -translate-x-1/2 z-[100] flex items-center gap-3 px-5 py-3 bg-red/90 backdrop-blur-sm rounded-2xl shadow-2xl shadow-red/20 text-white text-sm max-w-md",children:[(0,s.jsx)(eE.Z,{className:"w-5 h-5 shrink-0"}),(0,s.jsx)("span",{children:v})]})}):(0,s.jsx)(J.M,{children:(0,s.jsxs)(Z.E.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 z-[100] flex items-center justify-center",children:[(0,s.jsx)("div",{className:"absolute inset-0 bg-bg/95 backdrop-blur-xl"}),"video"===l&&"connected"===t&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("video",{ref:k,autoPlay:!0,playsInline:!0,className:"absolute inset-0 w-full h-full object-cover"}),(0,s.jsx)("div",{className:"absolute inset-0 bg-black/20"}),(0,s.jsx)(Z.E.div,{initial:{scale:.8,opacity:0},animate:{scale:1,opacity:1},className:"absolute top-4 right-4 w-32 h-44 sm:w-40 sm:h-56 rounded-2xl overflow-hidden border-2 border-white/20 shadow-2xl z-10",children:(0,s.jsx)("video",{ref:j,autoPlay:!0,playsInline:!0,muted:!0,className:"w-full h-full object-cover",style:{transform:"scaleX(-1)"}})})]}),("audio"===l||"connected"!==t)&&(0,s.jsxs)("div",{className:"relative z-10 flex flex-col items-center",children:[("calling"===t||"ringing"===t)&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("div",{className:"absolute w-40 h-40 rounded-full border-2 border-accent/20 animate-pulse-ring"}),(0,s.jsx)("div",{className:"absolute w-56 h-56 rounded-full border border-accent/10 animate-pulse-ring",style:{animationDelay:"0.5s"}})]}),(0,s.jsx)(Z.E.div,{initial:{scale:.5},animate:{scale:1},transition:{type:"spring",stiffness:200},children:(0,s.jsx)(el,{pubkey:i||"",name:null==T?void 0:T.name,picture:null==T?void 0:T.picture,size:"xl",showBorder:!0})}),(0,s.jsx)(Z.E.h2,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:.1},className:"mt-6 text-xl font-bold text-text",style:{fontFamily:"Space Grotesk"},children:_}),(0,s.jsxs)(Z.E.p,{initial:{opacity:0},animate:{opacity:1},transition:{delay:.2},className:"mt-2 text-sm text-text-secondary",children:["calling"===t&&(0,s.jsx)("span",{className:"animate-call-pulse",children:"Вызов..."}),"ringing"===t&&(0,s.jsxs)("span",{className:"animate-call-pulse flex items-center gap-2",children:[(0,s.jsx)(eM.Z,{className:"w-4 h-4"}),"Входящий ","video"===l?"видео":"аудио"," звонок"]}),"connected"===t&&(0,s.jsx)("span",{className:"text-green",children:E(m)})]})]}),"video"===l&&"connected"===t&&(0,s.jsxs)("div",{className:"absolute top-4 left-4 z-10 flex items-center gap-3 bg-black/50 backdrop-blur-sm rounded-2xl px-4 py-2",children:[(0,s.jsx)(el,{pubkey:i||"",name:null==T?void 0:T.name,picture:null==T?void 0:T.picture,size:"xs",showBorder:!0}),(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-sm font-medium text-white",children:_}),(0,s.jsx)("p",{className:"text-xs text-green",children:E(m)})]})]}),(0,s.jsxs)(Z.E.div,{initial:{y:50,opacity:0},animate:{y:0,opacity:1},transition:{delay:.3},className:"absolute bottom-8 sm:bottom-12 left-0 right-0 flex items-center justify-center gap-4 z-10",children:["ringing"===t&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(Z.E.button,{whileHover:{scale:1.1},whileTap:{scale:.9},onClick:()=>eS.rejectCall(),className:"w-16 h-16 rounded-full bg-red flex items-center justify-center shadow-lg shadow-red/30",children:(0,s.jsx)(eR.Z,{className:"w-7 h-7 text-white"})}),(0,s.jsx)(Z.E.button,{whileHover:{scale:1.1},whileTap:{scale:.9},onClick:()=>eS.acceptCall(),className:"w-16 h-16 rounded-full bg-green flex items-center justify-center shadow-lg shadow-green/30",children:(0,s.jsx)(eu.Z,{className:"w-7 h-7 text-white"})})]}),("calling"===t||"connected"===t)&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(Z.E.button,{whileHover:{scale:1.1},whileTap:{scale:.9},onClick:C,className:"w-14 h-14 rounded-full flex items-center justify-center transition-colors ".concat(o?"bg-red/20 text-red":"bg-white/10 text-white hover:bg-white/20"),children:o?(0,s.jsx)(eP.Z,{className:"w-6 h-6"}):(0,s.jsx)(eD.Z,{className:"w-6 h-6"})}),"video"===l&&(0,s.jsx)(Z.E.button,{whileHover:{scale:1.1},whileTap:{scale:.9},onClick:S,className:"w-14 h-14 rounded-full flex items-center justify-center transition-colors ".concat(h?"bg-red/20 text-red":"bg-white/10 text-white hover:bg-white/20"),children:h?(0,s.jsx)(ez.Z,{className:"w-6 h-6"}):(0,s.jsx)(em.Z,{className:"w-6 h-6"})}),(0,s.jsx)(Z.E.button,{whileHover:{scale:1.1},whileTap:{scale:.9},onClick:()=>eS.endCall(),className:"w-16 h-16 rounded-full bg-red flex items-center justify-center shadow-lg shadow-red/30",children:(0,s.jsx)(eR.Z,{className:"w-7 h-7 text-white"})})]})]})]})}):null}var eO=a(5929),eI=a(7226),eA=a(3417),eK=a(5805),eL=a(2655),eW=a(5922);function eF(e){let{icon:t,title:a,children:n,color:i}=e;return(0,s.jsx)("div",{className:"bg-bg-secondary p-6 rounded-2xl border border-border transform hover:-translate-y-1 transition-transform duration-300 ease-in-out",children:(0,s.jsxs)("div",{className:"flex items-start gap-4",children:[(0,s.jsx)("div",{className:"p-2 rounded-lg",style:{backgroundColor:"".concat(i,"1A")},children:t}),(0,s.jsxs)("div",{children:[(0,s.jsx)("h3",{className:"font-bold text-text text-lg",children:a}),(0,s.jsx)("p",{className:"text-sm text-text-secondary mt-1",children:n})]})]})})}function eU(){let{theme:e,setTheme:t}=(0,eW.F)();return(0,s.jsx)("button",{className:"p-2 rounded-full text-text-secondary hover:text-text hover:bg-bg-tertiary transition-colors",onClick:()=>t("dark"===e?"light":"dark"),children:"dark"===e?(0,s.jsx)(eO.Z,{size:20}):(0,s.jsx)(eI.Z,{size:20})})}function eB(){return(0,s.jsxs)("div",{className:"min-h-screen w-full flex items-center justify-center bg-bg p-4 relative overflow-hidden",children:[(0,s.jsx)("div",{className:"absolute inset-0 bg-[radial-gradient(circle_at_center,_var(--tw-gradient-stops))] from-accent/10 via-bg/0 to-bg/0 opacity-70"}),(0,s.jsx)("div",{className:"w-full max-w-4xl bg-bg-secondary/50 backdrop-blur-2xl border border-border rounded-3xl shadow-glow p-8 md:p-12 z-10",children:(0,s.jsxs)("div",{className:"flex flex-col items-center text-center",children:[(0,s.jsx)("div",{className:"p-3 bg-gradient-to-br from-accent to-blue-500 rounded-full mb-6 shadow-lg",children:(0,s.jsx)(O.Z,{size:32,className:"text-white"})}),(0,s.jsxs)("h1",{className:"text-5xl md:text-6xl font-bold mb-4 bg-clip-text text-transparent bg-gradient-to-r from-text to-text-secondary",children:["Welcome to ",(0,s.jsx)("span",{className:"bg-clip-text text-transparent bg-gradient-to-r from-accent to-blue-500",children:"Nostr"})]}),(0,s.jsx)("p",{className:"text-text-secondary text-lg md:text-xl max-w-2xl mb-10",children:"A new kind of social network. Decentralized, open, and free."}),(0,s.jsxs)("div",{className:"w-full grid grid-cols-1 md:grid-cols-3 gap-6 text-left mb-10",children:[(0,s.jsx)(eF,{title:"Direct Messages",icon:(0,s.jsx)(eA.Z,{size:24,className:"text-accent"}),color:"#7C3AED",children:"Encrypted, peer-to-peer conversations."}),(0,s.jsx)(eF,{title:"Public Channels",icon:(0,s.jsx)(eK.Z,{size:24,className:"text-cyan"}),color:"#22D3EE",children:"Join communities and discussions."}),(0,s.jsx)(eF,{title:"Your Identity",icon:(0,s.jsx)(eL.Z,{size:24,className:"text-green"}),color:"#4ADE80",children:"Controlled by you, not a corporation."})]}),(0,s.jsx)(eU,{})]})})]})}function eJ(){let{isLoggedIn:e,activeChat:t,showSidebar:a}=N();return((0,n.useEffect)(()=>{(async()=>{g.tryAutoLogin()&&(C(!0),await g.connectToRelays(),z())})()},[]),e)?(0,s.jsxs)("main",{className:"flex h-screen w-screen bg-bg text-text",children:[a&&(0,s.jsx)(ec,{}),(0,s.jsx)("div",{className:"flex-1 flex flex-col ".concat(a?"w-[calc(100vw-320px)]":"w-full"),children:t?(0,s.jsx)(e_,{}):(0,s.jsx)(eB,{})}),(0,s.jsx)(eZ,{})]}):(0,s.jsx)(B,{})}}},function(e){e.O(0,[640,971,117,744],function(){return e(e.s=1253)}),_N_E=e.O()}]);